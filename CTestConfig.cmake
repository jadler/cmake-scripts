SET (PROJECT_TEST_NAME ${PROJECT_NAME}Test CACHE STRING "Default project test name")
#SET_PROPERTY (DIRECTORY PROPERTY COMPILE_DEFINITIONS __TEST_CLASS__=${PROJECT_TEST_NAME})
SET (EXTRA_TEST_ARGS ${EXTRA_TEST_ARGS} ${EXTERNAL_LIBS})

ENABLE_TESTING ()

FIND_PACKAGE (GTest REQUIRED)
INCLUDE_DIRECTORIES (${GTEST_INCLUDE_DIRS})
SET (EXTRA_TEST_ARGS ${EXTRA_TEST_ARGS} ${GTEST_BOTH_LIBRARIES})

INCLUDE_DIRECTORIES (${CMAKE_CURRENT_SOURCE_DIR}/src)
LINK_DIRECTORIES (${CMAKE_CURRENT_BINARY_DIR})
LINK_DIRECTORIES (${CMAKE_MODULE_PATH})

FILE (GLOB TESTS_SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/test/src/*.c*")

IF (EXISTS "${CMAKE_SOURCE_DIR}/test/resources")
	FILE (COPY "${CMAKE_SOURCE_DIR}/test/resources" DESTINATION "${CMAKE_BINARY_DIR}")
ENDIF ()

ADD_EXECUTABLE (${PROJECT_TEST_NAME} ${TESTS_SOURCES} ${SOURCES})
ADD_DEPENDENCIES (${PROJECT_TEST_NAME} ${PROJECT_NAME}Library)
TARGET_LINK_LIBRARIES (${PROJECT_TEST_NAME} ${PROJECT_NAME} ${EXTRA_TEST_ARGS})

INCLUDE (GoogleTest)
GTEST_ADD_TESTS (TARGET ${PROJECT_TEST_NAME} SOURCES ${TESTS_SOURCES})
